% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
%
% LaTeX Presentation Template - Header File
%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% "THE BEER-WARE LICENSE" (Revision 42):
% Patrik Müller (p1muelle@hsr.ch) wrote this LaTeX template. As long as you retain 
% this notice you can do whatever you want with this stuff. If we meet some day, 
% and you think this stuff is worth it, you can buy me a beer in return. 
% - Patrik Müller
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

% Packages
\usetheme{default}

% Fonts
\usepackage[T1]{fontenc}
\usepackage[sc]{mathpazo}               % use palatino font!
\linespread{1.05}                       % palatino needs a bit more space!
\usepackage[T1,small,euler-digits]{eulervm}
\usepackage[scaled=0.8]{beramono}       % Use bera for mono fonts
\usefonttheme{professionalfonts}        % Setup beamer to use these fonts

% Math
\usepackage{amsmath}
\usepackage{amssymb}

% Babel
\newcommand*{\LangDE}{de}
\ifx \Lang \LangDE
    \usepackage[english,ngerman]{babel}
\else
    \usepackage[ngerman,english]{babel}
\fi

% Tables
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{multicol}

% Colors
\usepackage{xcolor}
\usepackage{header/ost_colors}

% Graphics
\usepackage{graphicx}
\usepackage{caption}
\usepackage{epstopdf}
\usepackage{tikz}
\usetikzlibrary{arrows,backgrounds,fit,positioning,calc,shapes,math}
\usepackage[american currents]{circuitikz}
\usepackage{tikz-timing}[2009/12/09]
\usepackage{pgfplots}
\pgfplotsset{compat = 1.3}

% Listings
\usepackage{listings}

% SI Units
\usepackage{siunitx}
\sisetup{detect-all,sticky-per,per-mode=symbol}

% Chemical formulae
\usepackage[version=3]{mhchem}

% EToolbox for e-TeX (programming)
\usepackage{etoolbox}

% OST Colorbox
\usepackage{tcolorbox}
\newtcolorbox{ostbox}[1]{colback=OSTwhite,colframe=OSTblackberry,title=#1}

% Setup date-time format
\usepackage{datetime}
\newdateformat{titledate}{\THEDAY.~\monthname\space\THEYEAR}

\newcommand*{\Background}{backgrounds/title_\Location_\TitlepageType}
\setbeamertemplate{navigation symbols}{}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% Setup Document
\title[\TitleShort]{\Title}
\subtitle{\Subtitle}
\author[\AuthorShort]{\Author}

\hypersetup{
    pdftitle={\Title},
    pdfauthor={\Author},
    pdfsubject={\Subtitle},
    pdfcreator={LaTeX with hyperref and Beamer}
}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% Color scheme
\setbeamercolor*{structure}{fg=OSTblackberry, bg=OSTblackberry}
\setbeamercolor*{frametitle}{fg=white,bg=OSTblackberry}

\defbeamertemplate{section in toc}{ost arrow}{
	\leavevmode\leftskip=5ex%
	\llap{\scalebox{0.7}{
		\begin{tikzpicture}[every path/.style={color=OSTblack,line width=2.3pt}]
			\coordinate (O) at (0pt, 6pt);
			\coordinate (T) at (12pt, 6pt);
			\draw (T) -- ++(-4pt, 0pt);
			\draw[color=OSTblackberry] (O) ++(4pt, 0pt) -- ++(4pt, 0pt);		
			\draw[color=OSTraspberry] (O) -- ++(4pt, 0pt);
			\draw (T)++(.7pt, .7pt) -- ++(-5.7pt, -5.7pt);
			\draw (T)++(.7pt, -.7pt) -- ++(-5.7pt, 5.7pt);
		\end{tikzpicture}}}%
	\hspace{1.ex}\textbf{\color{black}\inserttocsection}\par%
}

\defbeamertemplate{section in toc}{ost normal}{
	\leavevmode\leftskip=5ex%
	\llap{\raisebox{0.2ex}{\textcolor{OSTblackberry}{$\bullet$}}\kern1ex}%
	\hspace{1.ex}\color{black}\inserttocsection\par%
}

\setbeamertemplate{section in toc}[ost normal]
\setbeamertemplate{section in toc shaded}{%
	\leavevmode\leftskip=5ex%
	\llap{\raisebox{0.2ex}{\textcolor{OSTblackberry}{$\bullet$}}\kern1ex}%
	\hspace{1.ex}\color{black}\inserttocsection\par%
}
\setbeamertemplate{subsection in toc}{%
	\leavevmode\leftskip=8ex%
	\llap{\raisebox{0.2ex}{\textcolor{OSTblack}{\small$\bullet$}}\kern1ex}%
	\hspace{1.ex}\inserttocsubsection\par%
}
\setbeamertemplate{subsection in toc shaded}{%
	\leavevmode\leftskip=8ex%
	\llap{\raisebox{0.2ex}{\textcolor{OSTblack}{\small$\bullet$}}\kern1ex}%
	\hspace{1.ex}\inserttocsubsection\par%
}


\setbeamertemplate{itemize item}[circle]
\setbeamercolor*{itemize item}{fg=OSTblackberry}
\setbeamertemplate{itemize subitem}[circle]
\setbeamercolor*{itemize subitem}{fg=OSTblack}
\setbeamertemplate{itemize subsubitem}{-}
\setbeamercolor*{itemize subsubitem}{fg=OSTblack}

\setbeamertemplate{enumerate item}{\arabic{enumi})}
\setbeamercolor{enumerate item}{fg=OSTblackberry}
\setbeamertemplate{enumerate subitem}{\arabic{enumi}.\arabic{enumii})}
\setbeamercolor{enumerate subitem}{fg=black}
\setbeamertemplate{enumerate subsubitem}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii})}
\setbeamercolor{enumerate subsubitem}{fg=black}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% Title page
\defbeamertemplate*{title page}{customized}[1][]{
    \begin{tikzpicture}[remember picture,overlay,shift=(current page.south west)]

        \useasboundingbox (0,0) rectangle (\the\paperwidth,\the\paperheight);

		\if \TitlepageType 0
			% Background image
			\node at (current page.center) {\includegraphics[width=\the\paperwidth]{\Background}};
			
			 % Text
			\node[anchor=north west] at (63.4mm, 10.1mm) (institute){\parbox{80mm}{\scriptsize\Institute}};
			\node[anchor=south west, above=1.5mm of institute] (date) {\parbox{80mm}{\scriptsize\titledate\today}};
			\node[anchor=south west, above=0mm of date] (author) {\parbox{80mm}{\scriptsize\Author}};
			\node[inner ysep=0, outer sep=0, above=1.2cm of author.north west, anchor=north west] (subtitle) {\parbox{80mm}{\textbf{\color{OSTblack}\large\Subtitle}}};
			\node[anchor=south west, inner ysep=0, outer sep=0, text height=1cm, above=2mm of subtitle] (title) {\parbox{80mm}{\textbf{\color{OSTblackberry}\LARGE\Title}}};
		\else
			% Background image
			\node[yshift=7.5mm] at (current page.center) {\includegraphics[width=\the\paperwidth]{\Background}};
		
			% OST bars
			\node[anchor=south west,fill=OSTlightgray,fill opacity=0.8,text opacity=1,inner ysep=2mm] at (69.9mm, 35.1mm) (title) {\parbox{75.mm}{\textbf{\color{OSTblackberry}\LARGE\Title\strut}\vspace{-0.3\baselineskip}}};
			\node[anchor=north west,fill=OSTraspberry,fill opacity=0.8,text opacity=1,inner ysep=1mm] at (55.9mm,35.25mm) (subtitle) {\parbox{52.mm}{\text{\color{OSTwhite}\large\Subtitle\strut}\vspace{-0.15\baselineskip}}};
			
			% OST footbar
			\node[anchor=south west, fill=OSTwhite, minimum height=14.5mm, minimum width=\the\paperwidth] at (0mm, 0mm) (footbar){};
			\node[anchor=north west] at (7.7mm, 13.0mm) (institute) {\parbox{60mm}{\tiny\Institute}};
			\node[right=125.7mm of institute.north west, anchor=north west] (logo){\includegraphics[height=9mm]{header/ost_logo.png}}; % OST logo
			\node[right=of institute.north east, anchor=north west ] (author) {\parbox{44.5mm}{\tiny\Author}};
			\node[below=11.5mm of author.north west, anchor=south west] (date) {\parbox{44.5mm}{\tiny\titledate\today}};
		\fi		
    \end{tikzpicture}
}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% Footer
\newcommand*{\True}{true}
\setbeamertemplate{footline}
{
    \begin{tikzpicture}
        \useasboundingbox (0,0) rectangle (\the\paperwidth,1.0cm);
		\coordinate (barpos) at (10.4mm, 6mm);
		
		%        \ifx \ProgressBar \True
		%	         \pgfmathparse{\paperwidth/\inserttotalframenumber*\insertframenumber}
		%	         \pgfmathresult \let\hsrBeamerProgressWidth\pgfmathresult
		%            \draw[draw,fill] (0,1.2cm) rectangle (\hsrBeamerProgressWidth pt,1.15cm);
		%        \fi   

        \node[inner sep=0pt,anchor=west] at (140.7mm, 5mm) {\includegraphics[height=7.4mm]{header/ost_logo_no_text}};
        \node[outer xsep=1pt,anchor=north east] at (barpos) (slidenr) {\insertframenumber};
        \fill[color=OSTblackberry] (barpos) rectangle ++(1.5pt, -8mm);
        \node[outer xsep=2pt,anchor=north west] at (barpos) (title) {\parbox{66mm}{\TitleShort}};
        \node[right=4.7mm of title.north east,anchor=north west] (date) {\parbox{45mm}{\titledate\today}};

%        \ifdefempty{\Institute}{}{
%            \node[inner sep=0pt,anchor=east] at (\the\paperwidth-1em,0.6cm) {\InstituteShort};
%        }
    \end{tikzpicture}
}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% header
\newcommand{\ostheadline}[1]{
	\begin{tikzpicture}
		\useasboundingbox (0,0) rectangle (\the\paperwidth, 10.2mm);
		\node[inner sep=0pt,anchor=south west] at (10mm, 3.2mm) (section) {\textbf{\small\color{OSTblack}#1}};
	\end{tikzpicture}}
\defbeamertemplate{headline}{ost headline}{\ostheadline{\insertsection}}
\setbeamertemplate{headline}[ost headline]

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% frametitle
\setbeamertemplate{frametitle}
{
	\textbf{\LARGE\color{OSTblackberry}\insertframetitle}
}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% TOC at beginning of every section

\ifx \TocAtSection \True
    \AtBeginSection[]
    {
		\setbeamertemplate{headline}{\ostheadline{\contentsname}}
    	\setbeamertemplate{section in toc}[ost arrow]
        \begin{frame}<beamer>
            \OstToc[currentsection]
        \end{frame}
    	\setbeamertemplate{section in toc}[ost normal]
    	\setbeamertemplate{headline}[ost headline]
    }
\fi
